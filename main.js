(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function n(e,t,o,n,r,c,a){var i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),u=i.querySelector(".card__image"),s=i.querySelector(".card__likes"),l=e.link,p=e.name;u.src=e.link,u.alt=e.name,s.textContent=r,i.querySelector(".card__title").textContent=e.name;var d=i.querySelector(".card__delete-button"),_=i.querySelector(".card__like-button");return u.addEventListener("click",(function(){n(l,p)})),_.addEventListener("click",(function(e){o(e,a)})),c?d.addEventListener("click",(function(){t(i),fetch("https://nomoreparties.co/v1/wff-cohort-31/cards/".concat(a),{method:"DELETE",headers:{authorization:"2cd377c0-3859-41d5-99fa-922ec3473d0e","Content-Type":"application/json"},body:JSON.stringify({id:a})})})):d.classList.add("card__delete-button-disabled"),i}function r(e){e.remove()}function c(e,t){e.target.classList.toggle("card__like-button_is-active"),console.log(e.target.classList.contains("card__like-button_is-active")),e.target.classList.contains("card__like-button_is-active")?fetch("https://nomoreparties.co/v1/wff-cohort-31/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"2cd377c0-3859-41d5-99fa-922ec3473d0e","Content-Type":"application/json"},body:JSON.stringify({id:t})}):fetch("https://nomoreparties.co/v1/wff-cohort-31/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"2cd377c0-3859-41d5-99fa-922ec3473d0e","Content-Type":"application/json"},body:JSON.stringify({id:t})})}function a(e,t){var o=e.querySelectorAll(t.inputSelector),n=e.querySelector(t.submitButtonSelector);o.forEach((function(o){u(o,e.querySelector("#".concat(o.id,"-error")),t)})),n.classList.add(t.inactiveButtonClass),n.disabled=!0}function i(e){return"place-name"!==e.name&&"name"!==e.name||/^[a-zA-Zа-яА-Я\s-]+$/.test(e.value)}function u(e,t,o){e.classList.remove(o.inputErrorClass),t.textContent="",t.classList.remove(o.errorClass)}function s(e,t,o){Array.from(e).some((function(e){return!e.validity.valid||!i(e)}))?(t.classList.add(o.inactiveButtonClass),t.disabled=!0):(t.classList.remove(o.inactiveButtonClass),t.disabled=!1)}var l={baseUrl:"https://nomoreparties.co/v1/wff-cohort-31",headers:{authorization:"2cd377c0-3859-41d5-99fa-922ec3473d0e","Content-Type":"application/json"}};function p(){return fetch("".concat(l.baseUrl,"/users/me"),{headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function d(t,o){A.src=t,B.alt=o,B.textContent=o,e(z)}var _,f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},y=document.querySelector(".profile__title"),m=document.querySelector(".profile__description"),v=document.querySelector(".profile__image"),h=document.querySelector(".profile__edit-button"),S=document.querySelector(".popup_type_edit"),q=S.querySelector(".popup__close"),b=S.querySelector(".popup__input_type_name"),C=S.querySelector(".popup__input_type_description"),L=S.querySelector(".popup__form"),k=document.querySelector(".places__list"),E=document.querySelector(".profile__add-button"),g=document.querySelector(".popup_type_new-card"),x=g.querySelector(".popup__close"),T=g.querySelector(".popup__form"),j=g.querySelector(".popup__input_type_card-name"),w=g.querySelector(".popup__input_type_url"),z=document.querySelector(".popup_type_image"),A=z.querySelector(".popup__image"),B=z.querySelector(".popup__caption"),N=z.querySelector(".popup__close"),O=document.querySelectorAll(".popup"),J=document.querySelector(".popup_type_avatar-edit"),P=document.querySelector(".profile__image"),D=J.querySelector(".popup__close"),U=J.querySelector(".popup__input"),H=J.querySelector(".popup__form");L.addEventListener("submit",(function(e){L.querySelector(".popup__button").textContent="Сохранение...",function(e){e.preventDefault();var o=b.value,n=C.value;m.textContent=n,y.textContent=o,fetch("https://nomoreparties.co/v1/wff-cohort-31/users/me",{method:"PATCH",headers:{authorization:"2cd377c0-3859-41d5-99fa-922ec3473d0e","Content-Type":"application/json"},body:JSON.stringify({name:o,about:n})}),t(S)}(e),L.querySelector(".popup__button").textContent="Сохранить"})),H.addEventListener("submit",(function(e){e.preventDefault();var o=U.value;v.style.backgroundImage="url(".concat(o,")"),fetch("https://nomoreparties.co/v1/wff-cohort-31/users/me/avatar",{method:"PATCH",headers:{authorization:"2cd377c0-3859-41d5-99fa-922ec3473d0e","Content-Type":"application/json"},body:JSON.stringify({avatar:o})}),t(J)})),h.addEventListener("click",(function(){b.value=y.textContent,C.value=m.textContent,a(L,f),e(S)})),q.addEventListener("click",(function(){t(S)})),N.addEventListener("click",(function(){t(z)})),E.addEventListener("click",(function(){a(T,f),e(g)})),x.addEventListener("click",(function(){t(g)})),T.addEventListener("submit",(function(e){e.preventDefault();var o=n({name:j.value,link:w.value},r,c,d);k.prepend(o),fetch("https://nomoreparties.co/v1/wff-cohort-31/cards",{method:"POST",headers:{authorization:"2cd377c0-3859-41d5-99fa-922ec3473d0e","Content-Type":"application/json"},body:JSON.stringify({name:j.value,link:w.value})}),t(g),e.target.reset()})),P.addEventListener("click",(function(){p().then((function(e){U.value=e.avatar})).catch((function(e){console.log(e)})),e(J)})),D.addEventListener("click",(function(){t(J)})),function(e){document.querySelectorAll(e.formSelector).forEach((function(t){!function(e,t){var o=e.querySelectorAll(t.inputSelector),n=e.querySelector(t.submitButtonSelector);o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){var n=e.querySelector("#".concat(t.id,"-error"));t.validity.valid&&i(t)?u(t,n,o):function(e,t,o){e.classList.add(o.inputErrorClass),t.textContent=e.validationMessage||e.dataset.errorMessage,t.classList.add(o.errorClass)}(t,n,o)}(e,r,t),s(o,n,t)}))})),s(o,n,t)}(t,e)}))}(f),O.forEach((function(e){e.addEventListener("click",(function(o){o.target.classList.contains("popup")&&t(e)}))})),p().then((function(e){y.textContent=e.name,m.textContent=e.about,v.style.backgroundImage="url(".concat(e.avatar,")"),_=e._id})).catch((function(e){console.log(e)})),fetch("".concat(l.baseUrl,"/cards"),{headers:l.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t,o,a,i,u,s;t={name:e.name,link:e.link},o=e.likes.length,a=e.owner._id===_,i=e._id,u=document.querySelector(".places__list"),s=n(t,r,c,d,o,a,i),u.appendChild(s)}))})).catch((function(e){console.log(e)}))})();